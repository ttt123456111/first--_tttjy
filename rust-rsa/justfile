# æ˜¾ç¤ºå¯ç”¨å‘½ä»¤
default:
    @just --list

# è¿è¡ŒRSAåŠ å¯†æµ‹è¯•
run:
    cargo run

# è¿è¡Œå¹¶æŸ¥çœ‹æ•°æ®åº“ç»“æœ
run-db:
    cargo run
    @echo ""
    @echo "ğŸ“Š æŸ¥çœ‹æ•°æ®åº“ç»“æœ:"
    @echo "=================="
    mysql -h 127.0.0.1 -P 3306 -u root -proot123 testdb -e "
        SELECT 'RSAæµ‹è¯•' as æ¥æº, id, original as åŸå§‹æ¶ˆæ¯, 
               LEFT(encrypted, 50) as åŠ å¯†æ¶ˆæ¯é¢„è§ˆ, 
               decrypted as è§£å¯†æ¶ˆæ¯, created_at as åˆ›å»ºæ—¶é—´
        FROM rsa_test 
        UNION ALL
        SELECT 'Helloè¡¨', id, message, '', message, NOW()
        FROM hello
        ORDER BY æ¥æº, id;
    "

# æ¸…ç†æ•°æ®åº“è¡¨
clean-db:
    mysql -h 127.0.0.1 -P 3306 -u root -proot123 testdb -e "DROP TABLE IF EXISTS rsa_test;"
    @echo "âœ… rsa_test è¡¨å·²åˆ é™¤"

# æŸ¥çœ‹MySQLå®¹å™¨çŠ¶æ€
docker-status:
    docker ps | grep mysql || echo "MySQLå®¹å™¨æœªè¿è¡Œ"
    @echo ""
    @echo "ğŸ“‹ å®¹å™¨æ—¥å¿—:"
    docker logs --tail 20 mysql-test 2>/dev/null || echo "å®¹å™¨ä¸å­˜åœ¨"

# é‡å¯MySQLå®¹å™¨
docker-restart:
    docker restart mysql-test
    @echo "âœ… MySQLå®¹å™¨å·²é‡å¯"
    @sleep 3
    docker ps | grep mysql

# å®Œæ•´æµ‹è¯•ï¼ˆæ¸…ç†æ—§æ•°æ® + è¿è¡Œ + æŸ¥çœ‹ï¼‰
test: clean-db run-db

# æŸ¥çœ‹æ•°æ®åº“æ‰€æœ‰è¡¨
show-tables:
    mysql -h 127.0.0.1 -P 3306 -u root -proot123 testdb -e "SHOW TABLES;"

# ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
query:
    mysql -h 127.0.0.1 -P 3306 -u root -proot123 testdb -e "$(QUERY)"

# å¤‡ä»½æ•°æ®åº“
backup:
    mysqldump -h 127.0.0.1 -P 3306 -u root -proot123 testdb > backup_`date +%Y%m%d_%H%M%S`.sql
    @echo "âœ… æ•°æ®åº“å·²å¤‡ä»½"
